!function(e,t){"function"==typeof define&&define.amd?define([],t):e.FreeScroll=t()}(this,function(){"use strict";function e(i){if(!a(this))return new e(i);if(!i)return this;if(a(i))return i;if(this.options=e.updateOptions(o,i),this.promise=new u,this.instanceId=c(),this.options.selector){var s=t.querySelectorAll(this.options.selector);if("nodelist"===e.helper.typeOf(s)&&s.length>0){var f=n.apply(this,r.call(s)),p=this;return l=function(){var t=this;if(e.noMore(t,p.options.distance)){var n;null===p.options.requestData.urlFormat||p.finished||(n=e.xhr(p)),p.promise.more.call(p,t,n)}},p.addEvent("scroll",l),e.helper.ready(function(){l.call(p[0])}),f}return void new Error("Element(s) not found")}}var t=window.document,n=[].push,r=[].slice,o={selector:null,distance:100,requestData:{urlFormat:null,pageNumber:1,pageSize:10,maxItems:-1},templateUrl:null},i=[],s={},c=function(){var e="freeScroll",t=e+"_"+(i.length+1);return i.push(t),t},a=function(t){return t instanceof e},u=function(){this.more=function(){}},f=function(e,t){for(var n=0;n<e.length;n++)t(n,e[n])},l=function(){};return e.prototype={options:{},finished:!1,finish:function(e){this.removeEvent("scroll",l),this.finished=!0,console.log(e)},more:function(e){this.promise.more=e},addEvent:function(e,t){var n=this;s[n.instanceId]=t,n.each(function(t,r){r.attachEvent?(r["e"+e+s[n.instanceId]]=s[n.instanceId],r[e+s[n.instanceId]]=function(){r["e"+e+s[n.instanceId]](window.event)},r.attachEvent("on"+e,r[e+s[n.instanceId]])):r.addEventListener(e,s[n.instanceId],!1)})},removeEvent:function(e){var t=this;t.each(function(n,r){r.detachEvent?(r.detachEvent("on"+e,r[e+s[t.instanceId]]),r[e+s[t.instanceId]]=null):r.removeEventListener(e,s[t.instanceId],!1)}),delete s[t.instanceId]},each:function(e){var t=this;f(t,e)}},e.noMore=function(e,t){return e.scrollHeight-(e.scrollTop+t)<=e.clientHeight},e.genEventId=function(e,t){return e+"_"+t},e.updateOptions=function(t,n){var r=JSON.parse(JSON.stringify(t));if("object"==typeof n)for(var o in t)r[o]=t.hasOwnProperty(o)&&"object"!==e.helper.typeOf(t[o])&&t[o]!==n[o]?null!==n[o]&&"undefined"!==e.helper.typeOf(n[o])?n[o]:t[o]:t.hasOwnProperty(o)&&"object"===e.helper.typeOf(t[o])?e.updateOptions(t[o],n[o]):t[o];else"string"==typeof n&&(r=t,r.selector=n);return r},e.fn=e.prototype,e}),function(e,t){e.xhr=t()}(FreeScroll||{},function(){"use strict";return FreeScroll.fn.requestCount=0,function(e){var t={success:function(){},error:function(){}},n=FreeScroll.helper,r=XMLHttpRequest||ActiveXObject,o=new r("MSXML2.XMLHTTP.3.0"),i=e.options.requestData;return e.requestCount+=1,o.open("GET",i.urlFormat.format(i.pageNumber,i.pageSize)),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?(t.success.apply(t,n.parseJSON(o)),i.pageNumber+=1,i.maxItems>-1&&i.maxItems<=e.requestCount*i.pageSize&&e.finish("Reached maxItems to show")):(t.error.apply(t,n.parseJSON(o)),e.finish("Errored: status code = "+o.status)))},o.send(),{success:function(e){return t.success=e,t},error:function(e){return t.error=e,t}}}}),String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})}),function(e,t){e.helper=t()}(FreeScroll||{},function(){"use strict";var e={typeOf:function(e){var t={}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase();return"domwindow"===t&&("object"==typeof e?t="null":"undefined"==typeof e&&(t="undefined")),t},parseJSON:function(e){var t;try{t=JSON.parse(e.responseText)}catch(n){t=e.responseText}return[t,e]},ready:function(e){/complete/.test(document.readyState)?e():document.addEventListener("DOMContentLoaded",function(){e()},!1)}};return e});